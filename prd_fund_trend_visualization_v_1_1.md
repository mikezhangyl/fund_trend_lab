# PRD｜基金多时间区间趋势可视化工具（v1.1）

## 1. 目标与范围

**目标**
- 以多时间区间并列的方式，直观呈现基金/ETF 的日频趋势
- 支持跨基金、跨区间的同日期对齐对比
- 提供稳定、可复现的数据来源与本地缓存

**范围**
- 单用户、本地使用
- 仅展示事实数据，不提供预测、建议或评分

**不在范围**
- 账户体系、导出、指标体系、AI 分析与总结

---

## 2. 支持资产与数据口径

**资产类型**
- 中国公募基金
- ETF
- 指数（仅作对比基准）

**数据口径**
- 基金：累计净值（日频）
- 指数：日线收盘价
- 实时性：T+1 可接受

---

## 3. 数据架构（v1.1 新增，必须遵守）

**外部数据源**
- AKShare
- 仅用于数据摄取（ingestion）
- 不允许 UI 或业务层直接访问

**本地数据库（Single Source of Truth）**
- 轻量本地数据库（SQLite）
- 所有渲染、计算、极值判断均基于本地数据

**数据流原则**
- UI → 仅读取本地数据库
- 后台 → 异步使用 AKShare 更新本地数据库
- 同步失败不影响已有数据展示

---

## 4. 本地数据存储规范

**存储目标**
- 日频时间序列缓存
- 支持快速区间查询与增量更新

**推荐表结构（原则级）**
- instrument(code, name, type, source, created_at, updated_at)
- timeseries_daily(code, date, value, source_version)
  - 主键：(code, date)
  - 索引：(code, date)
- sync_state(code, last_success_date, last_sync_at, status, message)

**规则**
- 不存衍生指标
- 不做插值、不平滑
- 不回算历史

---

## 5. 页面与布局

**整体**
- 单页面应用
- 纵向列表

**行结构（Fund Row）**
- 每行一只基金/指数
- 横向并排 3 张折线图

**默认时间区间**
- 1 年
- 6 个月
- 1 个月

---

## 6. 时间区间管理

**内置区间**
- 固定存在，不可删除

**自定义区间**
- 输入天数（整数）
- 生成一个“自定义区间”
- 极值、百分比随区间动态变化
- UI 可选择替换默认区间之一

---

## 7. 图表规范与技术选型（关键）

### 7.1 图表类型
- 折线图

### 7.2 坐标轴
- X 轴：日期（日）
- Y 轴：累计净值原值
- 不显示刻度文字与图例

### 7.3 指数对比
- 每张基金图叠加一条指数线
- 默认指数：沪深 300
- 与基金共用同一 Y 轴
- 不做归一化，仅用于趋势对比

### 7.4 图表渲染技术（明确建议）
- 首选：Canvas/WebGL 型图表库（如 ECharts、uPlot、Vega-Lite Canvas 模式）
- 要求：
  - 支持多实例高性能渲染（10+ 行 × 3 图）
  - 支持自定义 hover、click、右键事件
  - 支持跨图同步光标
- 不建议：
  - 纯 SVG 实现

---

## 8. 核心交互（必须一致）

### 8.1 跨图同步时间线
- Hover 任意图表：
  - 在所有基金、所有区间同一日期位置绘制垂直线
  - 底部显示日期
  - 顶部显示当日价格（小字号）
- 左键点击：锁定时间线
- 右键点击：取消锁定

### 8.2 极值与变化
- 极值计算范围：当前时间区间
- 显示最大值与最小值标注
- 锁定时间线时显示：
  - 最大值 → 锁定日 % 变化
  - 最小值 → 锁定日 % 变化

---

## 9. 加载与性能策略

**加载原则**
- 每只基金独立任务
- 本地查询立即渲染
- 后台触发增量同步，完成后刷新该行

**性能指标**
- 首只基金 ≤ 3 秒可见
- 支持 ≥10 只基金并行
- 未完成加载显示 loading icon

---

## 10. 数据异常处理

- 日期不连续：断线显示
- 不补点、不插值
- 异常即原样呈现

---

## 11. 基金输入

**手动输入**
- 支持直接输入基金代码

**图片导入（v1.1 占位实现）**
- 输入：基金 App 自选截图
- 行为：自动识别 → 自动导入
- 不做确认
- 识别错误由用户自行修正

---

## 12. 状态保存与恢复

**保存内容**
- 基金列表
- 时间区间配置
- 自定义区间
- 指数选择
- 时间线锁定状态

**启动行为**
- 恢复完整 UI 状态
- 始终重新拉取最新数据（异步）

---

## 13. 非功能性约束

- 本地优先、离线可读
- 所有计算结果可复现
- 模块解耦，便于后续引入 Agent（非 v1.1 内容）

---

## 14. 验收标准

- ≥10 基金并行展示稳定
- 跨图时间线严格对齐
- 极值与百分比计算正确
- 单基金失败不影响整体
- 重启后状态恢复、数据更新

---

## 15. 版本说明

- v1.0：需求与交互定义
- v1.1：数据架构、技术选型、同步策略明确

